<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Materi Pembelajaran - EduToken</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        :root {
            --primary: #00f2ff;
            --secondary: #8a2be2;
            --dark: #0d1117;
            --card-bg: #161b22;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: var(--dark);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }
        
        .navbar-custom {
            background: var(--card-bg);
            border-bottom: 2px solid var(--primary);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .wallet-info {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.3);
        }
        
        .content-wrapper {
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .module-card {
            background: var(--card-bg);
            border: 2px solid var(--primary);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 242, 255, 0.2);
        }
        
        .module-card.locked {
            opacity: 0.5;
            filter: blur(2px);
            pointer-events: none;
        }
        
        .lock-badge {
            position: absolute;
            top: -15px;
            right: 20px;
            background: linear-gradient(135deg, #ff6b6b, #ff8787);
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            font-weight: bold;
            font-size: 0.9rem;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .module-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .module-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }
        
        .module-title {
            color: var(--primary);
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0;
        }
        
        .module-content {
            line-height: 1.8;
            color: #c9d1d9;
        }
        
        .module-content ul {
            padding-left: 1.5rem;
            margin: 1rem 0;
        }
        
        .module-content li {
            margin: 0.5rem 0;
        }
        
        .module-content strong {
            color: var(--primary);
        }
        
        .quiz-btn {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border: none;
            color: white;
            font-weight: bold;
            padding: 1rem 2rem;
            border-radius: 12px;
            width: 100%;
            margin-top: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }
        
        .quiz-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 0 25px rgba(0, 242, 255, 0.5);
        }
        
        .quiz-container {
            background: var(--card-bg);
            border: 2px solid var(--secondary);
            border-radius: 20px;
            padding: 2rem;
            display: none;
        }
        
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .timer-badge {
            background: #ff6b6b;
            padding: 0.7rem 1.5rem;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.1rem;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .progress-bar-custom {
            height: 8px;
            background: var(--primary);
            border-radius: 10px;
            transition: width 1s linear;
            margin-bottom: 2rem;
            box-shadow: 0 0 10px var(--primary);
        }
        
        .question-text {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            color: white;
            font-weight: 500;
        }
        
        .answer-btn {
            background: transparent;
            border: 2px solid #30363d;
            color: white;
            padding: 1rem;
            border-radius: 12px;
            width: 100%;
            margin-bottom: 1rem;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
        }
        
        .answer-btn:hover {
            border-color: var(--primary);
            background: rgba(0, 242, 255, 0.1);
            transform: translateX(5px);
        }
        
        .result-container {
            background: var(--card-bg);
            border: 2px solid var(--secondary);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            display: none;
        }
        
        .result-icon {
            font-size: 5rem;
            margin-bottom: 1rem;
        }
        
        .result-score {
            font-size: 2rem;
            margin: 1rem 0;
            color: white;
        }
        
        .result-reward {
            font-size: 2.5rem;
            color: #ffd700;
            margin: 1.5rem 0;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        
        .claim-btn {
            background: linear-gradient(135deg, #ffd700, #ffa500);
            color: #000;
            border: none;
            padding: 1.2rem 2rem;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            width: 100%;
            margin: 1rem 0;
            transition: all 0.3s ease;
        }
        
        .claim-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
        }
        
        .claim-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .back-btn {
            background: transparent;
            border: 2px solid white;
            color: white;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: white;
            color: var(--dark);
        }
        
        .metamask-guide {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 1rem;
            border-radius: 12px;
            margin: 2rem 0;
            text-align: center;
        }
        
        .metamask-guide a {
            color: white;
            font-weight: bold;
            text-decoration: none;
        }
        
        @media (max-width: 768px) {
            .content-wrapper {
                padding: 0 0.5rem;
            }
            
            .module-card {
                padding: 1.5rem;
            }
            
            .question-text {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar-custom">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center w-100">
                <a href="/dashboard" class="btn btn-outline-light">
                    ‚Üê Kembali ke Dashboard
                </a>
                <div class="wallet-info">
                    üíé <span id="userBalance">0</span> EDT
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="content-wrapper">
        
        <!-- MetaMask Guide -->
        <div class="metamask-guide">
            ü¶ä Pastikan MetaMask sudah terkoneksi ke <strong>Sepolia Testnet</strong>. 
            <a href="https://sepoliafaucet.com" target="_blank">Dapatkan Sepolia ETH gratis ‚Üí</a>
        </div>

        <!-- Materi 1 -->
        <div id="module1" class="module-card">
            <div class="module-header">
                <div class="module-icon">üìö</div>
                <h2 class="module-title">Materi 1: Pengenalan Kriptografi</h2>
            </div>
            <div class="module-content">
                <p><strong>Kriptografi</strong> adalah ilmu dan teknik untuk mengamankan informasi agar hanya dapat dibaca oleh pihak yang berwenang.</p>
                
                <p><strong>Tujuan utama kriptografi:</strong></p>
                <ul>
                    <li><strong>Confidentiality (Kerahasiaan)</strong> - Menjaga data agar tidak dibaca pihak tidak berwenang</li>
                    <li><strong>Integrity (Integritas)</strong> - Memastikan data tidak diubah tanpa izin</li>
                    <li><strong>Authentication (Autentikasi)</strong> - Memverifikasi identitas pengguna</li>
                    <li><strong>Non-repudiation</strong> - Mencegah penyangkalan atas tindakan yang dilakukan</li>
                </ul>
                
                <p><strong>Penerapan kriptografi modern:</strong></p>
                <ul>
                    <li>üåê Website HTTPS untuk komunikasi aman</li>
                    <li>üîê Sistem login dan password terenkripsi</li>
                    <li>üí≥ Transaksi digital dan perbankan online</li>
                    <li>‚õìÔ∏è Blockchain dan cryptocurrency</li>
                </ul>
                
                <p>Di platform <strong>EduToken</strong>, kriptografi digunakan untuk mengamankan data pengguna dan transaksi token digital Anda.</p>
            </div>
            <button class="quiz-btn" onclick="startQuiz(1)">
                üéØ MULAI KUIS MATERI 1
            </button>
        </div>

        <!-- Materi 2 -->
        <div id="module2" class="module-card locked">
            <div class="lock-badge">üîí Butuh 10 EDT</div>
            <div class="module-header">
                <div class="module-icon">üîê</div>
                <h2 class="module-title">Materi 2: Hashing</h2>
            </div>
            <div class="module-content">
                <p><strong>Hashing</strong> adalah proses mengubah data dengan panjang variabel menjadi nilai tetap (hash) menggunakan fungsi hash kriptografi.</p>
                
                <p><strong>Karakteristik fungsi hash:</strong></p>
                <ul>
                    <li><strong>Deterministik</strong> - Input yang sama selalu menghasilkan hash yang sama</li>
                    <li><strong>One-way</strong> - Sulit mengembalikan hash ke data asli</li>
                    <li><strong>Avalanche effect</strong> - Perubahan kecil menghasilkan hash sangat berbeda</li>
                    <li><strong>Fixed length</strong> - Output selalu berukuran tetap</li>
                </ul>
                
                <p><strong>Algoritma hash populer:</strong></p>
                <ul>
                    <li>üîπ MD5 (128-bit) - sudah tidak aman</li>
                    <li>üîπ SHA-1 (160-bit) - sudah tidak direkomendasikan</li>
                    <li>‚úÖ <strong>SHA-256</strong> (256-bit) - standar saat ini</li>
                    <li>üîπ SHA-3, BLAKE2 - alternatif modern</li>
                </ul>
                
                <p>Platform EduToken menggunakan <strong>SHA-256</strong> untuk:</p>
                <ul>
                    <li>Menyimpan password pengguna dengan aman</li>
                    <li>Menjaga integritas data transaksi</li>
                    <li>Verifikasi keaslian dokumen</li>
                </ul>
            </div>
            <button class="quiz-btn" onclick="startQuiz(2)">
                üéØ MULAI KUIS MATERI 2
            </button>
        </div>

        <!-- Materi 3 -->
        <div id="module3" class="module-card locked">
            <div class="lock-badge">üîí Butuh 20 EDT</div>
            <div class="module-header">
                <div class="module-icon">ü™ô</div>
                <h2 class="module-title">Materi 3: Token Digital & Blockchain</h2>
            </div>
            <div class="module-content">
                <p><strong>Token digital</strong> adalah representasi nilai dalam sistem blockchain yang dapat dipindahkan antar pengguna secara terdesentralisasi.</p>
                
                <p><strong>Konsep dasar blockchain:</strong></p>
                <ul>
                    <li>üì¶ <strong>Block</strong> - Wadah yang berisi kumpulan transaksi</li>
                    <li>‚õìÔ∏è <strong>Chain</strong> - Setiap block terhubung dengan block sebelumnya</li>
                    <li>üîê <strong>Hash</strong> - Setiap block memiliki hash unik</li>
                    <li>üåê <strong>Distributed</strong> - Data tersebar di banyak komputer</li>
                </ul>
                
                <p><strong>Cara kerja EduToken:</strong></p>
                <ul>
                    <li>Setiap pengguna memiliki <strong>wallet</strong> dengan alamat unik</li>
                    <li>Token diperoleh sebagai <strong>reward</strong> menyelesaikan kuis</li>
                    <li>Token dapat <strong>ditransfer</strong> ke pengguna lain</li>
                    <li>Semua transaksi tercatat di <strong>blockchain Sepolia</strong></li>
                </ul>
                
                <p><strong>Keamanan transaksi:</strong></p>
                <ul>
                    <li>Setiap transaksi di-hash menggunakan SHA-256</li>
                    <li>Jika data transaksi diubah, hash akan berubah (deteksi manipulasi)</li>
                    <li>Blockchain menjamin <strong>integritas</strong> dan <strong>transparansi</strong></li>
                </ul>
                
                <p>üéì Dengan memahami materi ini, Anda sudah menguasai dasar-dasar kriptografi yang digunakan dalam sistem blockchain modern!</p>
            </div>
            <button class="quiz-btn" onclick="startQuiz(3)">
                üéØ MULAI KUIS MATERI 3
            </button>
        </div>

        <!-- Quiz Container -->
        <div id="quizContainer" class="quiz-container">
            <div class="quiz-header">
                <h4 id="questionNumber" style="color: var(--primary); margin: 0;">Soal 1 / 5</h4>
                <div class="timer-badge" id="timer">20s</div>
            </div>
            <div class="progress-bar-custom" id="timerBar" style="width: 100%;"></div>
            <div id="questionArea"></div>
        </div>

        <!-- Result Container -->
        <div id="resultContainer" class="result-container">
            <div class="result-icon">üéâ</div>
            <h2 style="color: var(--primary);">Kuis Selesai!</h2>
            <div class="result-score" id="scoreText">Jawaban Benar: 0/5</div>
            <div class="result-reward" id="rewardText">Reward: 0 EDT</div>
            <button class="claim-btn" id="claimBtn" onclick="claimReward()">
                üöÄ KLAIM REWARD KE METAMASK
            </button>
            <button class="back-btn" onclick="location.reload()">
                ‚Üê Kembali ke Materi
            </button>
        </div>

    </div>

    <script>
        // ============== KONFIGURASI ==============
        const CONTRACT_ADDRESS = "0xYOUR_CONTRACT_ADDRESS_HERE"; // GANTI INI!
        const CONTRACT_ABI = [
            {"inputs":[],"stateMutability":"nonpayable","type":"constructor"},
            {"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"student","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"claimReward","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}
        ];

        // ============== DATABASE SOAL ==============
        const QUESTIONS = {
            1: [
                {q: "Apa tujuan utama dari aspek Confidentiality dalam kriptografi?", a: ["Menjaga kerahasiaan data", "Mempercepat transfer data", "Mengkompresi data", "Menghapus data"], c: 0},
                {q: "Platform EduToken menggunakan kriptografi untuk mengamankan apa?", a: ["Hardware komputer", "Data pengguna dan transaksi", "Koneksi internet", "Monitor layar"], c: 1},
                {q: "Apa contoh penerapan kriptografi dalam kehidupan sehari-hari?", a: ["Membaca buku", "Website HTTPS", "Menonton TV", "Bermain game"], c: 1},
                {q: "Apa arti dari Integrity dalam kriptografi?", a: ["Kecepatan data", "Keutuhan dan keakuratan data", "Ukuran data", "Warna data"], c: 1},
                {q: "Kata 'Kryptos' dalam bahasa Yunani berarti?", a: ["Terbuka", "Tersembunyi", "Cepat", "Besar"], c: 1}
            ],
            2: [
                {q: "Hashing mengubah data dengan panjang variabel menjadi nilai dengan panjang?", a: ["Acak", "Tetap", "Kosong", "Besar"], c: 1},
                {q: "Sifat fungsi hash yang sulit dikembalikan ke data asli disebut?", a: ["One-way function", "Two-way function", "Symmetric", "Asymmetric"], c: 0},
                {q: "Algoritma hash yang digunakan di platform EduToken adalah?", a: ["MD5", "SHA-1", "SHA-256", "AES-128"], c: 2},
                {q: "Hashing biasanya digunakan untuk menyimpan apa dengan aman?", a: ["Foto", "Password", "Video", "Musik"], c: 1},
                {q: "Jika input yang sama di-hash, hasilnya akan?", a: ["Berbeda setiap kali", "Selalu sama", "Acak", "Kosong"], c: 1}
            ],
            3: [
                {q: "Di platform EduToken, token diperoleh dari?", a: ["Membeli", "Reward menyelesaikan kuis", "Pinjaman", "Undian"], c: 1},
                {q: "Jika data transaksi diubah, hash akan?", a: ["Tetap sama", "Berubah total", "Terhapus", "Membesar"], c: 1},
                {q: "Kemampuan mendeteksi perubahan data disebut?", a: ["Integritas data", "Kapasitas data", "Input data", "Output data"], c: 0},
                {q: "Token digital disimpan di?", a: ["Bank", "Wallet blockchain", "USB", "Hard disk"], c: 1},
                {q: "Semua transaksi EduToken dicatat di?", a: ["Excel", "Blockchain", "Word", "Notepad"], c: 1}
            ]
        };

        // ============== VARIABEL GLOBAL ==============
        let currentModule = 0;
        let currentQuestion = 0;
        let correctCount = 0;
        let timerInterval = null;
        let userAddress = null;

        // ============== FUNGSI UPDATE BALANCE ==============
        async function updateBalance() {
            if (typeof window.ethereum === 'undefined') {
                document.getElementById('userBalance').textContent = '0 (Install MetaMask)';
                return;
            }

            try {
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const accounts = await provider.send("eth_requestAccounts", []);
                userAddress = accounts[0];
                
                const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, provider);
                const balance = await contract.balanceOf(userAddress);
                const balanceFormatted = Math.floor(ethers.utils.formatUnits(balance, 18));
                
                document.getElementById('userBalance').textContent = balanceFormatted;

                // Unlock modules
                if (balanceFormatted >= 10) {
                    document.getElementById('module2').classList.remove('locked');
                }
                if (balanceFormatted >= 20) {
                    document.getElementById('module3').classList.remove('locked');
                }
            } catch (error) {
                console.error('Error updating balance:', error);
                document.getElementById('userBalance').textContent = '0';
            }
        }

        // ============== FUNGSI START QUIZ ==============
        function startQuiz(moduleNumber) {
            currentModule = moduleNumber;
            currentQuestion = 0;
            correctCount = 0;
            
            // Hide modules
            document.querySelectorAll('.module-card').forEach(el => el.style.display = 'none');
            
            // Show quiz
            document.getElementById('quizContainer').style.display = 'block';
            
            showQuestion();
        }

        // ============== FUNGSI TAMPILKAN SOAL ==============
        function showQuestion() {
            const questionData = QUESTIONS[currentModule][currentQuestion];
            
            document.getElementById('questionNumber').textContent = `Soal ${currentQuestion + 1} / 5`;
            
            let html = `<p class="question-text">${questionData.q}</p>`;
            
            const labels = ['A', 'B', 'C', 'D'];
            questionData.a.forEach((answer, index) => {
                html += `<button class="answer-btn" onclick="checkAnswer(${index})">
                    <strong>${labels[index]}.</strong> ${answer}
                </button>`;
            });
            
            document.getElementById('questionArea').innerHTML = html;
            
            startTimer();
        }

        // ============== FUNGSI TIMER ==============
        function startTimer() {
            let timeLeft = 20;
            clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = timeLeft + 's';
                document.getElementById('timerBar').style.width = (timeLeft / 20 * 100) + '%';
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    checkAnswer(-1); // Wrong answer
                }
            }, 1000);
        }

        // ============== FUNGSI CEK JAWABAN ==============
        function checkAnswer(selectedIndex) {
            clearInterval(timerInterval);
            
            const correctIndex = QUESTIONS[currentModule][currentQuestion].c;
            
            if (selectedIndex === correctIndex) {
                correctCount++;
            }
            
            currentQuestion++;
            
            if (currentQuestion < 5) {
                setTimeout(showQuestion, 300);
            } else {
                showResult();
            }
        }

        // ============== FUNGSI TAMPILKAN HASIL ==============
        function showResult() {
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('resultContainer').style.display = 'block';
            
            const reward = correctCount * 2;
            
            document.getElementById('scoreText').textContent = `Jawaban Benar: ${correctCount}/5`;
            document.getElementById('rewardText').textContent = `Reward: ${reward} EDT`;
        }

        // ============== FUNGSI KLAIM REWARD ==============
        async function claimReward() {
            if (typeof window.ethereum === 'undefined') {
                alert('‚ùå MetaMask tidak terdeteksi! Silakan install MetaMask terlebih dahulu.');
                window.open('https://metamask.io', '_blank');
                return;
            }

            const claimBtn = document.getElementById('claimBtn');
            const originalText = claimBtn.textContent;
            
            try {
                claimBtn.disabled = true;
                claimBtn.textContent = '‚è≥ Memproses...';

                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const signer = provider.getSigner();
                const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

                const rewardAmount = correctCount * 2;
                
                claimBtn.textContent = 'ü¶ä Konfirmasi di MetaMask...';
                
                const tx = await contract.claimReward(
                    await signer.getAddress(),
                    rewardAmount
                );

                claimBtn.textContent = '‚õìÔ∏è Menunggu konfirmasi blockchain...';
                
                await tx.wait();

                alert(`‚úÖ Berhasil! ${rewardAmount} EDT telah masuk ke wallet Anda!`);
                
                await updateBalance();
                
                setTimeout(() => {
                    location.reload();
                }, 2000);

            } catch (error) {
                console.error('Claim error:', error);
                
                let errorMsg = 'Terjadi kesalahan saat klaim reward.';
                
                if (error.code === 4001) {
                    errorMsg = 'Transaksi dibatalkan oleh user.';
                } else if (error.message.includes('insufficient funds')) {
                    errorMsg = 'Saldo Sepolia ETH tidak cukup untuk gas fee. Dapatkan di https://sepoliafaucet.com';
                } else if (error.message.includes('Claim cooldown')) {
                    errorMsg = 'Mohon tunggu 5 menit sebelum klaim berikutnya.';
                }
                
                alert('‚ùå ' + errorMsg);
                
                claimBtn.disabled = false;
                claimBtn.textContent = originalText;
            }
        }

        // ============== INIT ==============
        window.addEventListener('load', () => {
            updateBalance();
            
            // Auto-refresh balance every 30 seconds
            setInterval(updateBalance, 30000);
        });
    </script>
</body>
</html>